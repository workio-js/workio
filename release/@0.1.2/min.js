var g=async()=>{import.meta.url='\0base\0';let c='\0runtimeKey\0',e='\0sudoKey\0',s={},a=async function(){let o,r,t,n;return await'\0workerFn\0'(...arguments[0])};class d{constructor(){}}Object.defineProperties(self,{env:{value:Object.defineProperties({},{type:{value:'function',writable:!1},op_close:{value:new d,writable:!1}}),writable:!1}}),Object.assign(self,{window:self,close(){return self.env.op_close},fetch:c==='other'?function(o){return function(){return c==='other'&&(arguments[0]=new URL(arguments[0],import.meta.url)),o.apply(this,arguments)}}(self.fetch):self.fetch}),self.addEventListener('message',({data:o})=>{o.sudoKey===e&&{async 0({initArgs:r}){Object.assign(s,await a(r)),self.postMessage({code:0,sudoKey:e,methodList:Object.keys(s)})},async 1({methodName:r,workerArgs:t,taskId:n}){if(!(r in s)){self.postMessage({code:3,taskId:n,sudoKey:e});return}(i=>{if(i===self.env.op_close){self.postMessage({code:4,taskId:n,sudoKey:e});return}self.postMessage({code:2,returnValue:i,taskId:n,sudoKey:e},i instanceof(ArrayBuffer||MessagePort||ReadableStream||WritableStream||TransformStream||AudioData||ImageBitmap||VideoFrame||OffscreenCanvas||RTCDataChannel)?[i]:null)})(await s[r](...t))},async 2({initArgs:r,taskId:t}){self.postMessage({taskId:t,returnValue:await a(r),sudoKey:e})}}[o.code](o)},{passive:!0})};function h(){return btoa(String.fromCharCode.apply(null,crypto.getRandomValues(new Uint8Array(64))))}var p=globalThis?.process?.release?.name==='node'?'node':globalThis?.Deno!==void 0?'deno':globalThis?.Bun!==void 0?'bun':globalThis?.fastly!==void 0?'fastly':globalThis?.__lagon__!==void 0?'lagon':globalThis?.WebSocketPair instanceof Function?'workerd':globalThis?.EdgeRuntime instanceof String?'edge-light':'other';var m=class{constructor(){this.pool={},this.nextId=0n}push({resolveExec:e,rejectExec:s}){let a=this.nextId;return this.pool[this.nextId]={resolveExec:e,rejectExec:s},this.nextId++,a}resolve({taskId:e,returnValue:s}){this.pool[e].resolveExec(s),delete this.pool[e]}reject({taskId:e}){this.pool[e].rejectExec('Method not found'),delete this.pool[e]}};function P(c){switch(!1){case new.target:case c instanceof Function:return;default:{let e=h(),s=URL.createObjectURL(new Blob([`(${g.toString().replace(/\\0sudoKey\\0/,e).replace(/\\0runtimeKey\\0/,p).replace(/'\\0base\\0'/,p==='other'?`'${window.location.href}'`:'undefined').replace(/'\\0workerFn\\0'/,`(${c.toString()})`)})()`],{type:'application/javascript'}));return function(...a){let d=!!new.target;return new Promise((o,r)=>{let t=new Worker(s,{type:'module',eval:!0});if(d){let n=new m,i={};t.postMessage({code:0,initArgs:a,sudoKey:e}),t.addEventListener('message',({data:f})=>{f.sudoKey===e&&{0({methodList:l}){l.forEach(u=>{i[u]=(...y)=>new Promise((b,w)=>{t.postMessage({code:1,methodName:u,workerArgs:y,taskId:n.push({resolveExec:b,rejectExec:w}),sudoKey:e})})}),o(i)},1(){r('Failed to initialization')},2({returnValue:l,taskId:u}){n.resolve({returnValue:l,taskId:u})},3({taskId:l}){n.reject({taskId:l})},4({taskId:l}){n.resolve({taskId:l}),t.terminate();for(let u in i)delete i[u]}}[f.code](f)},{passive:!0})}else t.postMessage({code:2,initArgs:a,sudoKey:e}),t.addEventListener('message',({data:n})=>{n.sudoKey===e&&(o(n.returnValue),t.terminate())},{passive:!0})})}}}}export{P as Workio};
