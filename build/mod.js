const g=new WeakMap;export const Workio=Object.assign(async(n,a)=>{const{port1:r,port2:u}=new MessageChannel,o=new Worker(import.meta.resolve("./temp.js"),{type:"module"}),p=new Uint32Array(1),i={},m=function(t){let e;for(;(e=crypto.getRandomValues(p)[0])in i;);return i[e]=t,e},l=function(...t){const{method:e}=this||{};return new Promise(s=>r.postMessage({type:"call",body:{method:e,args:t},uuid:m(s)}))},c=crypto.getRandomValues(p)[0];n=a?new URL(n,a).href:n,o.postMessage({src:n,port:u},[u]),r.postMessage({type:"init",uuid:c}),r.onmessage=({data:{type:t,body:e,uuid:s}})=>{switch(t){case"return":{i[s]?.(e);break}}};const d=await new Promise(t=>o.onmessage=({data:{type:e,body:s,uuid:w}})=>{e!=="init"||w!==c||(delete o.onmessage,t(s.IS_DEFAULT))})?(...t)=>l.apply(null,t):new Proxy({},{get(t,e){if(e!="then")return l.bind({method:e})}});return g.set(d,o),d},{terminate(n){g.get(n)?.terminate()}});
