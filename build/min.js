async function h(){import.meta.url='\0base\0';let p='\0runtimeKey\0',e='\0sudoKey\0',n={};class f{constructor(){}}Object.defineProperties(self,{env:{value:Object.defineProperties({},{type:{value:'function',writable:!1},op_close:{value:new f,writable:!1}}),writable:!1}}),Object.assign(self,{window:self,close:()=>self.env.op_close,fetch:p==='other'?(s=>function(){return p==='other'&&(arguments[0]=new URL(arguments[0],import.meta.url)),s.apply(this,arguments)})(self.fetch):self.fetch}),self.addEventListener('message',({data:s})=>{s.sudoKey===e&&{0({initArgs:a}){Object.assign(n,function(){let l,r,t,o,c,d;return'\0workerFn\0'(...a)}()),self.postMessage({code:0,sudoKey:e,methodList:Object.keys(n)})},async 1({methodName:a,workerArgs:l,taskId:r}){if(!(a in n)){self.postMessage({code:3,taskId:r,sudoKey:e});return}(t=>{if(t===self.env.op_close){self.postMessage({code:6,taskId:r,sudoKey:e});return}self.postMessage({code:2,returnValue:t,taskId:r,sudoKey:e},t instanceof(ArrayBuffer||MessagePort||ReadableStream||WritableStream||TransformStream||AudioData||ImageBitmap||VideoFrame||OffscreenCanvas||RTCDataChannel)?[t]:null)})(await n[a](...l))}}[s.code](s)},{passive:!0})}function b(){return btoa(String.fromCharCode.apply(null,crypto.getRandomValues(new Uint8Array(64))))}var m=globalThis?.process?.release?.name==='node'?'node':globalThis?.Deno!==void 0?'deno':globalThis?.Bun!==void 0?'bun':globalThis?.fastly!==void 0?'fastly':globalThis?.__lagon__!==void 0?'lagon':globalThis?.WebSocketPair instanceof Function?'workerd':globalThis?.EdgeRuntime instanceof String?'edge-light':'other';var g=class{constructor(){this.pool={},this.nextId=0n}push({resolveExec:e,rejectExec:n}){let f=this.nextId;return this.pool[this.nextId]={resolveExec:e,rejectExec:n},this.nextId++,f}setResponse({taskId:e,returnValue:n}){this.pool[e].resolveExec(n),delete this.pool[e]}rejectResponse({taskId:e}){this.pool[e].rejectExec('Method not found'),delete this.pool[e]}};var v=class{constructor(e){if(!(new.target&&e instanceof Function))return;let n=b(),f=URL.createObjectURL(new Blob([`(${h.toString().replace(/\\0sudoKey\\0/,n).replace(/\\0runtimeKey\\0/,m).replace(/'\\0base\\0'/,m==='other'?`'${window.location.href}'`:'undefined').replace(/'\\0workerFn\\0'/,`(${e.toString()})`)})()`],{type:'application/javascript'}));return function(...s){let a=!!new.target;return new Promise(function(l,r){let t=new Worker(f,{type:'module',eval:!0});if(a){let o=new g,c={};t.postMessage({code:0,initArgs:s,sudoKey:n}),t.addEventListener('message',function({data:d}){d.sudoKey===n&&{0({methodList:i}){i.forEach(u=>{c[u]=function(...y){return new Promise(function(w,j){t.postMessage({code:1,methodName:u,workerArgs:y,taskId:o.push({resolveExec:w,rejectExec:j}),sudoKey:n})})}}),l(c)},1(){r('Failed to initialization')},2({returnValue:i,taskId:u}){o.setResponse({returnValue:i,taskId:u})},3({taskId:i}){o.rejectResponse(i)},6({taskId:i}){o.setResponse({taskId:i}),t.terminate();for(let u in c)delete c[u]}}[d.code](d)},{passive:!0})}else t.postMessage({code:2,initArgs:s,sudoKey:n,isInstance:!1}),t.addEventListener('message',function({data:o}){o.sudoKey===n&&(o.initSucceed?l(o.returnValue):r(),t.terminate())},{passive:!0})})}}};export{v as Workio};
