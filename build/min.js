var M=Object.defineProperty;var u=(t,e)=>()=>(t&&(e=t(t=0)),e);var l=(t,e)=>{for(var s in e)M(t,s,{get:e[s],enumerable:!0})};var m={};l(m,{runtimeKey:()=>S});var S,f=u(()=>{S=globalThis?.process?.release?.name==='node'?'node':globalThis?.Deno!==void 0?'deno':globalThis?.Bun!==void 0?'bun':globalThis?.fastly!==void 0?'fastly':globalThis?.__lagon__!==void 0?'lagon':globalThis?.WebSocketPair instanceof Function?'workerd':globalThis?.EdgeRuntime instanceof String?'edge-light':'other'});var y={};l(y,{scriptURL:()=>_});function _(t){return O==='node'?t:URL.createObjectURL(new Blob([t],{type:'application/javascript'}))}var O,h=u(async()=>{({runtimeKey:O}=await Promise.resolve().then(()=>(f(),m)))});var b={};l(b,{TaskPool:()=>k});var k,w=u(()=>{k=class{constructor(){this.pool={},this.nextId=0,this.vacantId=[],this.reservedResponse=[]}push({resolve:e,reject:s}){let r=null;return this.vacantId.length?(r=this.vacantId[0],this.vacantId.shift()):(r=this.nextId,this.nextId++),this.pool[r]={resolve:e,reject:s},r}setResponse({taskId:e,returnValue:s}){this.pool[e].resolve(s),this.taskGC({taskId:e})}rejectResponse({taskId:e}){this.pool[e].reject('Method not found'),this.taskGC({taskId:e})}taskGC({taskId:e}){this.pool[e]=void 0,e+1===this.nextId?this.nextId--:this.vacantId.push(e)}}});var R={};l(R,{random64:()=>E});function E(){return btoa(String.fromCharCode.apply(null,crypto.getRandomValues(new Uint8Array(64))))}var v=u(()=>{});var T={};l(T,{workerTemp:()=>A});async function A(){import.meta.url='\0base\0';class t{constructor(){}}Object.defineProperties(self,{env:{value:Object.defineProperties({},{type:{value:'function',writable:!1},op_close:{value:new t,writable:!1}}),writable:!1}}),Object.assign(self,{window:self,close:()=>self.env.op_close,fetch:(n=>function(){return arguments[0]=new URL(arguments[0],import.meta.url),n.apply(this,arguments)})(self.fetch)}),'XMLHttpRequest'in globalThis&&(XMLHttpRequest.prototype.open=(n=>function(){return arguments[1]=new URL(arguments[1],import.meta.url),n.apply(this,arguments)})(XMLHttpRequest.prototype.open));let e='\0sudoKey\0',s={},r=!1,i=[],a=async function({task:n,args:o,taskId:p}){n in s?(c=>{self.postMessage({sudoKey:e,returnValue:c,taskId:p,close:c===self.env.op_close},c instanceof(ArrayBuffer||MessagePort||ReadableStream||WritableStream||TransformStream||AudioData||ImageBitmap||VideoFrame||OffscreenCanvas||RTCDataChannel)?[c]:null)})(await s[n](...o)):self.postMessage({sudoKey:e,methodNotFound:!0,taskId:p})};self.addEventListener('message',async({data:n})=>{n.sudoKey===e&&(n.workerArgs&&(Object.assign(s,await async function(){let o,p,c,d;return await'\0workerFn\0'(...n.workerArgs)}()),r=!0,i.forEach(o=>a(o)),i=[]),'task'in n&&(r?a(n):i.push(n)))},{passive:!0})}var j=u(()=>{});var K={};l(K,{WorkioWorker:()=>x});var B,D,g,q,G,x,L=u(async()=>{({scriptURL:B}=await h().then(()=>y)),{TaskPool:D}=await Promise.resolve().then(()=>(w(),b)),{runtimeKey:g}=await Promise.resolve().then(()=>(f(),m)),{random64:q}=await Promise.resolve().then(()=>(v(),R)),{workerTemp:G}=await Promise.resolve().then(()=>(j(),T)),x=class{constructor({workerFn:e,constructorConfig:s,workerArgs:r}){let i=q(),a=new D,n=new Worker(B(`(${G.toString().replace(/\\0sudoKey\\0/,i).replace(/\\0base\\0/,g==='other'?window.location.href:g==='deno'?Deno.cwd():void 0).replace(/'\\0workerFn\\0'/,'('+e.toString()+')')})()`),{type:'module',eval:!0});return n.postMessage({workerArgs:r,sudoKey:i}),n[g==='node'?'on':'addEventListener']('message',({data:o})=>{if(o.sudoKey)switch(i){case o.sudoKey:'returnValue'in o&&(a.setResponse(o),o.close===!0&&n.terminate()),o.methodNotFound&&a.rejectResponse(o)}},{passive:!0}),new Proxy(this,{get(o,p,c){return function(){return new Promise((d,U)=>{n.postMessage({sudoKey:i,task:p,args:[...arguments],taskId:a.push({resolve:d,reject:U})})})}}})}}});var C={};l(C,{WorkioFunction:()=>I});var I,P=u(async()=>{w();await h();f();I=class{constructor({resolve:e,workerFn:s,workerArgs:r}){}}});var W={};l(W,{constConfig:()=>H});function H(t){return{as:'as'in t?t.as:'worker',type:'type'in t?t.type:'web',shared:'shared'in t?t.shared:void 0,immidiate:'immidiate'in t?t.immidiate:!1}}var F=u(()=>{});var{WorkioWorker:X}=await L().then(()=>K),{WorkioFunction:z}=await P().then(()=>C),{runtimeKey:ne}=await Promise.resolve().then(()=>(f(),m)),{constConfig:oe}=await Promise.resolve().then(()=>(F(),W)),N=class{constructor(e,s){switch(!1){case new.target:throw new Error('calling Workio constructor without new is invalid');case e instanceof Function:throw new TypeError('first argument must be a type of function');default:return function(...i){return new.target?new X({workerFn:e,workerArgs:i}):new Promise(a=>new z({resolve:a,workerFn:e,workerArgs:i}))}}}static config(e){}};export{N as Workio};
